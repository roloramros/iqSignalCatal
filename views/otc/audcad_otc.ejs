<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cat√°logo de Patrones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .tooltip-wrapper {
            position: relative;
            display: inline-block;
        }

        .tooltip-box {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 1px solid #ccc;
            width: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: opacity 0.3s;
            z-index: 9999;
            width: 500px;
        }

        .tooltip-wrapper:hover .tooltip-box {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-contenido img {
            max-width: 100%;
            display: block;
            margin: auto;
        }

        .tooltip-contenido p {
            margin: 5px 0 0;
            font-size: 14px;
            color: #333;
            text-align: center;
        }

        .candle-strip {
            display: flex;
            justify-content: center;
            padding: 15px;
            background: #f4f4f4;
            gap: 13px;
            flex-wrap: wrap;
        }

        .candle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(0, 0, 0, 0.2));
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            border: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #fff;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .candle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
        }

        .dropdown-wrapper {
            margin-right: 20px;
        }

        .main-container {
            display: flex;
            flex: 1;
        }

        .left-panel {
            width: 75%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            align-items: start;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            border-right: 2px solid #ccc;
        }

        .right-panel {
            width: 25%;
            padding: 10px;
            box-sizing: border-box;
            background-color: #f8f9fa;
            border-left: 1px solid #dee2e6;
        }

        .patron {
            width: 100%;
            margin: 0;
        }


        .patron h3 {
            margin: 5px 0;
            text-align: left;
            font-size: 17px;
            font-weight: bold;
        }

        .cuadros {
            display: grid;
            grid-template-columns: repeat(9, 35px);
            gap: 3px;
        }

        .cuadro {
            display: flex;
            /* Habilita flexbox para centrado f√°cil */
            align-items: center;
            width: 35px;
            height: 25px;
            border: 2px solid black;
            background-color: white;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fdfdfd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table th,
        table td {
            padding: 5px 3px !important;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #dee2e6;
            font-size: 14px;
        }

        table th {
            background-color: #e9ecef;
            font-weight: 600;
        }


        #popup-se√±al {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #222;
            color: #fff;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            min-width: 300px;
            max-width: 90%;
            display: none;
        }

        .popup-content {
            position: relative;
        }

        .cerrar-popup {
            position: absolute;
            top: 5px;
            right: 8px;
            background: transparent;
            color: #fff;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }

        #popup-texto {
            font-size: 18px;
            text-align: center;
            padding-top: 10px;
        }

        #popup-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .popup-alert {
            background: #222;
            color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-width: 250px;
            max-width: 300px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        .popup-texto {
            font-size: 14px;
            text-align: left;
        }

        .cinta-informativa {
            position: fixed;
            bottom: 0;
            /* Cambia a bottom: 0; si la quieres abajo */
            left: 0;
            width: 100%;
            background: #333;
            color: #fff;
            overflow: hidden;
            white-space: nowrap;
            z-index: 9999;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .contenido-cinta {
            display: inline-block;
            padding-left: 100%;
            animation: scrollCinta 30s linear infinite;
            font-size: 14px;
        }

        @keyframes scrollCinta {
            0% {
                transform: translateX(0%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Media queries para ajustar el tama√±o m√≠nimo seg√∫n el tama√±o de pantalla */
        @media (max-width: 1200px) {
            .left-panel {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 900px) {
            .left-panel {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .cinta-informativa {
                position: fixed;
                top: 0;
            }


            .main-container {
                position: relative;
            }

            .left-panel {
                width: 100%;
                border-right: none;
                grid-template-columns: 1fr;
                padding: 10px 5px;
            }

            .right-panel {
                position: fixed;
                top: 0;
                right: -100%;
                width: 100%;
                height: 100vh;
                background: #f8f9fa;
                z-index: 1000;
                border-left: none;
                transition: right 0.3s ease;
                padding-top: 60px;
                overflow-y: auto;
            }

            .right-panel.show {
                right: 0;
            }

            .close-panel {
                position: absolute;
                top: 10px;
                right: 10px;
                background: #dc3545;
                color: white;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 18px;
                cursor: pointer;
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 1001;
            }

            .right-panel.show .close-panel {
                display: flex;
            }

            /* Overlay para cerrar paneles tocando fuera */
            .panel-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .panel-overlay.show {
                display: block;
            }

        }

        @media (max-width: 480px) {
            .left-panel {
                padding: 5px;
                gap: 15px;
            }

            .patron h3 {
                font-size: 14px;
            }

            .cuadros {
                grid-template-columns: repeat(9, 30px);
            }

            .cuadro {
                width: 30px;
                height: 20px;
            }

            .mobile-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>

    <div class="candle-strip" id="candle-strip">

        <!-- Se insertar√°n din√°micamente -->
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
        <div class="candle"></div>
    </div>

    <div class="mobile-controls">
        <button id="toggle-sidebar" class="mobile-btn">
            <span>‚öôÔ∏è</span>
        </button>
        <button id="toggle-right-panel" class="mobile-btn">
            <span>‚ò∑</span>
        </button>
    </div>

    <div class="main-container">
        <!-- PANEL IZQUIERDO: PATRONES -->
        <div class="left-panel">
            <!-- Agregar m√°s patrones din√°micamente -->
        </div>

        <!-- PANEL DERECHO: GU√çA DE INTERPRETACI√ìN -->
        <div class="right-panel">
            <table id="tablaPatrones" class="table table-hover table-striped table-bordered">

                <thead>
                    
                    <tr>
                        <th>Si vela form√°ndose cierra: </th>
                        <th colspan="3">Alcista</th>
                        <th colspan="3">Bajista</th>
                    </tr>
                    
                    
                    <tr>
                        <th></th>
                        <th>Dir</th>
                        <th>G1</th>
                        <th>G2</th>
                        <th>Dir</th>
                        <th>G1</th>
                        <th>G2</th>
                    </tr>
                </thead>
                
                
                
                <tbody>
                    <tr>
                        <td>MHI Minor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>

                    <tr>
                        <td>MHI 2 Minor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>MHI 3 Minor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Mill√≥n Minor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>MHI Mayor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>MHI 2 Mayor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>MHI 3 Mayor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Mill√≥n Mayor√≠a</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Torres Gemelas</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Mejor de 3</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Tres Mosqueteros</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Patr√≥n Impar</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Tres Vecinos</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Patron 3x1</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>Patr√≥n 23</td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                </tbody>
            </table>
            <div id="estadisticas-globales"
                style="padding: 10px; background-color: #f0f0f0; border-top: 2px solid #ccc; font-size: 14px; line-height: 1.6;">
                <!-- Las estad√≠sticas aparecer√°n aqu√≠ -->
            </div>


        </div>

    </div>


    <div class="cinta-informativa">
        <div class="contenido-cinta" id="contenido-cinta">
            üî• Bienvenido al panel de catalogaci√≥n | üì¢ Para generar se√±ales de entrada recuerda configurar por primera
            vez como deseas operar
            | üöÄ Nuevas funciones funciones en desarrollo disponibles pr√≥ximamente.
        </div>
    </div>

    <!-- Contenedor de todas las alertas -->
    <div id="popup-container"></div>

    <script>
        let historicoMHI = [], historicoMHI2 = [], historicoMHI3 = [], historicoMILLONMIN = [];
        let historicoMHIMAY = [], historicoMHI2MAY = [], historicoMHI3MAY = [], historicoMILLONMAY = [];
        let historicoTORRESGEMELAS = [], historicoMEJOR3 = [], historicoMOSQUETEROS = [], historicoPATRONIMPAR = []
        let historicoTRESVECINOS = [], historicoPATRON3X1 = [], historicoPADRON23 = []

        let tablaPar = "audcad_otc";
        let analisisPar = "AUD/CAD OTC"

        let ultimoMinutoProcesado = null; // Variable global para rastrear el √∫ltimo minuto procesado
        let ultimaVelaProcesada = null; // Almacenar√° el ID o timestamp de la √∫ltima vela procesada
        let ultimaVela = null;


        let signalConfig = null;
        let userId = null;


        let confluenciaActiva = false;
        let condicionConfluencia = null;
        let direccionObjetivoConfluencia = null;
        let firstLoss = 0;



        let condicionCoincidencia = null;
        let velaBuscadaCoincidencia = null;
        let estadisticasTotales = null;
        let estadisticasPorcentual = null;
        let estadoAnteriorPatrones = {};
        let twoLoss = {};
        let threeloss = {};
        let alcanza100 = {};
        let pierde100 = {};
        let dosPerdidasSeguidas = {};
        let tresPerdidasSeguidas = {};
        let cuadranteConDoji = {};
        let historicoPatrones = {};

    </script>


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>

    <script>
        //import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabaseUrl = "<%= supabaseUrl %>";
        const supabaseKey = "<%= supabaseKey %>";
        const clientesupabase = supabase.createClient(supabaseUrl, supabaseKey);
        const coloresDigitos = new Array(10).fill(null); // Inicialmente vac√≠o

        document.addEventListener('DOMContentLoaded', () => {

            const patrones = [
                'MHI Minor√≠a', 'MHI 2 Minor√≠a', 'MHI 3 Minor√≠a',
                'MHI Mayor√≠a', 'MHI 2 Mayor√≠a', 'MHI 3 Mayor√≠a',
                'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a', 'Torres Gemelas',
                'Mejor de 3', 'Tres Mosqueteros', 'Patr√≥n Impar',
                'Tres Vecinos', 'Patron 3x1', 'Patr√≥n 23'
            ];
            const leftPanel = document.querySelector('.left-panel');

            const infoPatrones = {
                'MHI Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'MHI 2 Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi2-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'MHI 3 Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi3-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'MHI Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'MHI 2 Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi2-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'MHI 3 Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi3-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Mill√≥n Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/millon-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Mill√≥n Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/millon-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Torres Gemelas': `
        <div class="tooltip-contenido">
            <img src="imagenes/torres_gemelas.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Mejor de 3': `
        <div class="tooltip-contenido">
            <img src="imagenes/mejor_tres.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Tres Mosqueteros': `
        <div class="tooltip-contenido">
            <img src="imagenes/tres_mosqueteros.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Patr√≥n Impar': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_impar.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Tres Vecinos': `
        <div class="tooltip-contenido">
            <img src="imagenes/tres_vecinos.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Patron 3x1': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_3x1.png" alt="MHI Minor√≠a ">
        </div>
    `,
                'Patr√≥n 23': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_23.png" alt="MHI Minor√≠a ">
        </div>
    `,

                // ... resto de patrones
            };






            patrones.forEach(nombre => {
                const patronDiv = document.createElement('div');
                patronDiv.className = 'patron';
                patronDiv.innerHTML = `
            <div class="tooltip-wrapper">
            <h3>${nombre}</h3>
            <div class="tooltip-box">
                ${infoPatrones[nombre] || ''}
            </div>
        </div>
            <div class="cuadros" id="${nombre.replace(/\s/g, '_')}">
                ${Array(24).fill().map((_, i) =>
                    `<div class="cuadro" data-patron="${nombre}" data-index="${i}"></div>`
                ).join('')}
            </div>
        `;
                leftPanel.appendChild(patronDiv);
            });
        });






        async function cargarVelas() {
            const { data, error } = await clientesupabase
                .from(tablaPar)
                .select('*')
                .order('id', { ascending: false })  // ‚úÖ Ordenamos por ID descendente
                .limit(15);

            if (!data || data.length === 0) {
                return;
            }

            const container = document.getElementById('candle-strip');
            container.innerHTML = '';
            // Mostramos las velas en orden cronol√≥gico (de m√°s vieja a m√°s nueva)
            for (let i = data.length - 1; i >= 0; i--) {
                const vela = data[i];
                // Crear div de la vela
                const div = document.createElement('div');
                div.classList.add('candle');

                const color = vela.candle_color?.toLowerCase().trim() || 'gray';
                div.style.backgroundColor = color === 'green' ? 'green' : color === 'red' ? 'red' : 'gray';

                const horaStr = vela.start_time.toString();
                const minuto = horaStr.split(':')[1] || '00';
                const digito = minuto % 10;
                coloresDigitos[digito] = color;

                div.innerText = minuto;
                container.appendChild(div);
            }

        }

        async function esperarNuevaVela() {
            while (true) {
                try {
                    const { data, error } = await clientesupabase
                        .from(tablaPar)
                        .select('id, start_time, candle_color')
                        .order('id', { ascending: false })
                        .limit(1);
                    if (!error && data.length > 0) {
                        const velaActual = data[0];
                        if (!ultimaVelaProcesada || ultimaVelaProcesada.id !== velaActual.id) {
                            ultimaVelaProcesada = velaActual;
                            await cargarVelas();
                            analizarVelaPorDigito(velaActual);
                            calcularPorcentaje();
                            calcularPorcentajeNoPerdidasPorPatron();
                            verificaAlertas();
                        }
                    }
                } catch (e) {
                    console.error("‚ö†Ô∏è Error leyendo velas:", e);
                }
                const sleep_time = calculateSecondsToNextMinute() - 2
                await new Promise(resolve => setTimeout(resolve, sleep_time));
            }
        }

        function calculateSecondsToNextMinute() {
            const now = new Date();
            const secondsCurrentMinute = now.getSeconds();
            const milliseconds = now.getMilliseconds() / 1000;
            let secondsToNextMinute = 60 - secondsCurrentMinute - milliseconds;
            secondsToNextMinute += 0.1
            return Math.max(0.1, secondsToNextMinute); // M√≠nimo 0.1 segundos
        }

        window.addEventListener('DOMContentLoaded', async () => {
            cargarSignalConfiguracion();
            await cargarVelas();
            const cantidadDeVelas = calcularCantidadDeVelas();
            const colores = await obtenerColoresDeVelas(cantidadDeVelas);
            const velas = await obtenerVelas(cantidadDeVelas);


            for (let i = 0; i < velas.length; i++) {
                velaActual = velas[i];
                const color = velaActual.candle_color?.toLowerCase().trim() || 'gray';
                const horaStr = velaActual.start_time.toString();
                const minuto = horaStr.split(':')[1] || '00';
                const digito = minuto % 10;
                coloresDigitos[digito] = color;
                analizarVelaPorDigito(velaActual);
            }
            esperarNuevaVela();
        });





        function agregarResultadoAlHistorico(patronId, resultado) {
            if (!historicoPatrones[patronId]) {
                historicoPatrones[patronId] = [];
            }
            // Agregar nuevo resultado
            historicoPatrones[patronId].push(resultado);
            // Mantener m√°ximo 24 elementos
            if (historicoPatrones[patronId].length > 24) {
                historicoPatrones[patronId].shift();
            }
            // Repintar usando tu funci√≥n existente
            actualizarHistorico(patronId, historicoPatrones[patronId]);
        }


        function analizarVelaPorDigito(vela) {
            const horaStr = vela.start_time.toString();
            const minuto = parseInt(horaStr.split(':')[1] || '0');
            const digito = minuto % 10;
            const funciones = [
                digito0, digito1, digito2, digito3, digito4,
                digito5, digito6, digito7, digito8, digito9
            ];
            const funcion = funciones[digito];
            if (funcion) funcion(vela);
        }

        function getCelda(patron, columnaIndex) {
            const tabla = document.getElementById('tablaPatrones');
            for (let i = 1; i < tabla.rows.length; i++) { // saltamos encabezado
                const fila = tabla.rows[i];
                if (fila.cells[0].innerText.trim() === patron.trim()) {
                    return fila.cells[columnaIndex];
                }
            }
            return null; // No encontrada
        }

        function colorMenosRepetido(indices) {
            let contador = { green: 0, red: 0 };
            for (let i of indices) {
                const color = coloresDigitos[i];
                if (color === 'green') contador.green++;
                else if (color === 'red') contador.red++;
            }
            const total = contador.green + contador.red;
            if (total === 0) return null;
            if (contador.green === indices.length) return 'red';
            if (contador.red === indices.length) return 'green';
            if (contador.green === contador.red) return 'empate';
            return contador.green < contador.red ? 'green' : 'red';
        }

        function colorMasRepetido(indices) {
            let contador = { green: 0, red: 0 };

            for (let i of indices) {
                const color = coloresDigitos[i];
                if (color === 'green') contador.green++;
                else if (color === 'red') contador.red++;
            }

            const total = contador.green + contador.red;
            if (total === 0) return null;

            if (contador.green === contador.red) return 'empate';

            // Devolver el m√°s repetido
            return contador.green > contador.red ? 'green' : 'red';
        }

        async function obtenerColoresDeVelas(cantidad) {

            const { data, error } = await clientesupabase
                .from(tablaPar)
                .select('candle_color, start_time, id')  // üëà incluimos id tambi√©n para depurar mejor
                .order('id', { ascending: false })       // ‚úÖ ordenar por ID descendente
                .limit(cantidad + 10);

            if (error) {
                console.error("Error al leer de Supabase:", error);
                return [];
            }

            const dataOrdenada = data.reverse();  // ‚úÖ ahora est√°n en orden cronol√≥gico
            dataOrdenada.forEach((v, i) => {
                const hora = new Date(`1970-01-01T${v.start_time}`).toLocaleTimeString();
            });


            const colores = dataOrdenada.map(v => v.candle_color?.toLowerCase().trim() || 'gray');
            return colores;
        }

        async function obtenerVelas(cantidad) {

            const { data, error } = await clientesupabase
                .from(tablaPar)
                .select('candle_color, start_time, id')  // üëà incluimos id tambi√©n para depurar mejor
                .order('id', { ascending: false })       // ‚úÖ ordenar por ID descendente
                .limit(cantidad + 10);

            if (error) {
                console.error("Error al leer de Supabase:", error);
                return [];
            }

            const dataOrdenada = data.reverse();  // ‚úÖ ahora est√°n en orden cronol√≥gico
            dataOrdenada.forEach((v, i) => {
                const hora = new Date(`1970-01-01T${v.start_time}`).toLocaleTimeString();
            });


            const colores = dataOrdenada.map(v => v.candle_color?.toLowerCase().trim() || 'gray');
            return dataOrdenada;
        }









        async function actualizarHistorico(patronId, historicoPatron) {

            const cuadrosContainer = document.getElementById(patronId);
            if (!cuadrosContainer) {
                console.error(`No se encontr√≥ el patr√≥n con ID: ${patronId}`);
                return;
            }
            if (historicoPatron.length === 0) {
                console.warn('No hay datos en historicoPatron para aplicar al patr√≥n');
                return;
            }
            // Aplicar cada valor del hist√≥rico a su cuadro correspondiente
            historicoPatron.forEach((valor, index) => {
                const cuadroEspecifico = cuadrosContainer.querySelector(`.cuadro[data-index="${index}"]`);
                if (cuadroEspecifico) {
                    // Aplicar estilo seg√∫n el valor
                    switch (valor) {
                        case 'D':
                            cuadroEspecifico.style.backgroundColor = "green";
                            cuadroEspecifico.textContent = "";
                            break;
                        case 'G1':
                            cuadroEspecifico.style.backgroundColor = "green";
                            cuadroEspecifico.textContent = "G1";
                            break;
                        case 'G2':
                            cuadroEspecifico.style.backgroundColor = "green";
                            cuadroEspecifico.textContent = "G2";
                            break;
                        case 'L':
                            cuadroEspecifico.style.backgroundColor = "red";
                            cuadroEspecifico.textContent = "";
                            break;
                        case 'E':
                            cuadroEspecifico.style.backgroundColor = "gray";
                            cuadroEspecifico.textContent = "";
                            break;
                        default:
                            console.warn(`Valor desconocido en historicoPatron: ${valor}`);
                    }
                } else {
                    console.warn(`No se encontr√≥ cuadro con data-index="${index}" en el patr√≥n ${patronId}`);
                }
            });
        }

        function limpiarTablaPatrones() {
            const tabla = document.getElementById("tablaPatrones");
            if (!tabla) return;

            const celdas = tabla.querySelectorAll("td");
            celdas.forEach(celda => {
                celda.style.backgroundColor = ""; // Borra el fondo de cada celda
            });
        }

    </script>


    <script>
        async function verificaAlertas() {
            const ahora = new Date();
            const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                ahora.getMinutes().toString().padStart(2, '0');


            //Primero Confirmo si el usuario tiene las notificaciones activadas
            if (signalConfig.notificacion !== "none") {
                //Leer configuracion martingala
                let gale = "No usar Martin Gala";
                let condicion = "";
                let operacion = "";
                let cantGale = 0;
                if (signalConfig.martin_gala === "gale2") {
                    gale = "Usar 2 Martin Gala";
                    cantGale = 2
                } else if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale1trasperdida") {
                    gale = "Usar 1 Martin Gala";
                    cantGale = 1
                }


                if (signalConfig.confluencia) {  //Notificacion para la confluencia de patrones
                    if (condicionConfluencia === ultimaVela) {
                        confluenciaActiva = true;
                    } else if (condicionConfluencia !== ultimaVela) {     //else if (condicionConfluencia !== null && condicionConfluencia !== ultimaVela) {
                        confluenciaActiva = false;
                        condicionConfluencia = null;
                        direccionObjetivoConfluencia = null;
                        firstLoss = 0;
                    }

                    if (confluenciaActiva) {

                        if (signalConfig.martin_gala === "gale1trasperdida") {
                            if (direccionObjetivoConfluencia === 'green') {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                                }
                            }
                            if (direccionObjetivoConfluencia === 'red') {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                                }
                            }
                            confluenciaActiva = false;
                            condicionConfluencia = null;
                            direccionObjetivoConfluencia = null;
                            firstLoss = 0;
                        }

                        if (signalConfig.martin_gala === "nogale") {
                            if (firstLoss === 0) {
                                console.log("Se cumplo la condicion")
                            }
                            if (firstLoss === 1) {
                                console.log("Perdio 1ra Entrada")
                                if (direccionObjetivoConfluencia === 'green') {
                                    guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                        mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                                    }
                                    if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                        envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                                    }
                                }
                                if (direccionObjetivoConfluencia === 'red') {
                                    guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                        mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                                    }
                                    if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                        envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                                    }
                                }
                                confluenciaActiva = false;
                                condicionConfluencia = null;
                                direccionObjetivoConfluencia = null;
                                firstLoss = 0;
                            }
                            if (firstLoss === 0 && direccionObjetivoConfluencia !== ultimaVela) {
                                firstLoss++;
                            }
                        }
                    }

                    const conteo = contarCeldasColoreadas();
                    if (conteo.verde.verde === 6) {
                        console.log("Si verde CALL");
                        if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                            guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "CALL", cantGale)
                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                mostrarPopup("Confluencia de Patrones", "Alcista", "CALL", gale);
                            }
                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                envioTelegram("Confluencia de Patrones", "Alcista", "CALL", gale)
                            }
                        } else {
                            condicionConfluencia = 'green'
                            direccionObjetivoConfluencia = 'green'
                        }
                    }
                    if (conteo.verde.rojo === 6) {
                        console.log("Si verde PUT");
                        if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                            guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                            }
                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                            }
                        } else {
                            condicionConfluencia = 'green'
                            direccionObjetivoConfluencia = 'red'
                        }
                    }
                    if (conteo.rojo.verde === 6) {
                        console.log("Si roja CALL");
                        if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                            guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                            }
                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                            }
                        } else {
                            condicionConfluencia = 'red'
                            direccionObjetivoConfluencia = 'green'
                        }
                    }
                    if (conteo.rojo.rojo === 6) {
                        console.log("Si roja PUT");
                        if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                            guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "PUT", cantGale)
                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                mostrarPopup("Confluencia de Patrones", "Bajista", "PUT", gale);
                            }
                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                envioTelegram("Confluencia de Patrones", "Bajista", "PUT", gale)
                            }
                        } else {
                            condicionConfluencia = 'red'
                            direccionObjetivoConfluencia = 'red'
                        }
                    }
                }

                if (signalConfig.alcanza_100) { // Notificaci√≥n para cuando alcanza el 100%
                    for (let patron in alcanza100) {
                        if (alcanza100[patron]) {
                            const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                fila => fila.cells[0]?.textContent.trim() === patron.trim()
                            );
                            if (filaTabla) {
                                let columnas = [];
                                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                    columnas = [1, 4];
                                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                    columnas = [2, 5];
                                } else if (signalConfig.martin_gala === "nogale") {
                                    columnas = [3, 6];
                                }
                                let infoColores = [];
                                for (let col of columnas) {
                                    const cell = filaTabla.cells[col];
                                    const bg = cell?.style.backgroundColor.toLowerCase();
                                    if (bg === "green" || bg === "red") {
                                        const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                        const operacion = (bg === "green") ? "CALL" : "PUT";
                                        infoColores.push({ condicion, operacion });
                                    }
                                }
                                if (infoColores.length > 0) {
                                    // Evitamos duplicadas si las dos columnas tienen mismo color y condici√≥n
                                    const operaciones = infoColores.map(i => i.operacion);
                                    const operacionesUnicas = [...new Set(operaciones)];
                                    if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                        // Las dos son iguales ‚Üí una sola alerta
                                        const operacion = operacionesUnicas[0];
                                        const condicion = infoColores[0].condicion; // Tomamos cualquiera
                                        guardarAlertaEnSupabase(`${patron} alcanza 100%`, hora_final, "Alc/Baj", operacion, cantGale)

                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup(`${patron} alcanza 100%`, "Alc/Baj", operacion, gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram(`${patron} alcanza 100%`, "Alc/Baj", operacion, gale)
                                        }
                                    } else {
                                        // Hay dos diferentes ‚Üí mostramos ambas
                                        for (let info of infoColores) {
                                            guardarAlertaEnSupabase(`${patron} alcanza 100%`, hora_final, info.condicion, info.operacion, cantGale)
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} alcanza 100%`, info.condicion, info.operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} alcanza 100%`, info.condicion, info.operacion, gale)
                                            }
                                        }
                                    }
                                    alcanza100[patron] = false;
                                }
                            }
                        }
                    }
                }

                if (signalConfig.pierde_100) { //Notificacion para cuando pierde el 100%
                    for (let patron in pierde100) {
                        if (pierde100[patron]) {
                            const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                fila => fila.cells[0]?.textContent.trim() === patron.trim()
                            );
                            if (filaTabla) {
                                let columnas = [];
                                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                    columnas = [1, 4];
                                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                    columnas = [2, 5];
                                } else if (signalConfig.martin_gala === "nogale") {
                                    columnas = [3, 6];
                                }
                                let infoColores = [];
                                for (let col of columnas) {
                                    const cell = filaTabla.cells[col];
                                    const bg = cell?.style.backgroundColor.toLowerCase();
                                    if (bg === "green" || bg === "red") {
                                        const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                        const operacion = (bg === "green") ? "CALL" : "PUT";
                                        infoColores.push({ condicion, operacion });
                                    }
                                }
                                if (infoColores.length > 0) {
                                    // Evitamos duplicadas si las dos columnas tienen mismo color y condici√≥n
                                    const operaciones = infoColores.map(i => i.operacion);
                                    const operacionesUnicas = [...new Set(operaciones)];

                                    if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                        // Las dos son iguales ‚Üí una sola alerta
                                        const operacion = operacionesUnicas[0];
                                        const condicion = infoColores[0].condicion; // Tomamos cualquiera
                                        guardarAlertaEnSupabase(`${patron} pierde 100%`, hora_final, "Alc/Baj", operacion, cantGale)
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup(`${patron} pierde 100%`, "Alc/Baj", operacion, gale);

                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram(`${patron} pierde 100%`, "Alc/Baj", operacion, gale)
                                        }
                                    } else {
                                        // Hay dos diferentes ‚Üí mostramos ambas
                                        for (let info of infoColores) {
                                            guardarAlertaEnSupabase(`${patron} pierde 100%`, hora_final, info.condicion, info.operacion, cantGale)
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} pierde 100%`, info.condicion, info.operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} pierde 100%`, info.condicion, info.operacion, gale)
                                            }
                                        }
                                    }
                                    pierde100[patron] = false;
                                }
                            }
                        }
                    }
                }

                if (signalConfig.perdidas_2) { // Notificaci√≥n para dos p√©rdidas consecutivas
                    detectarDosPerdidasSeguidas();
                    for (let patron in dosPerdidasSeguidas) {
                        if (dosPerdidasSeguidas[patron]) {
                            const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                fila => fila.cells[0]?.textContent.trim() === patron.trim()
                            );
                            if (filaTabla) {
                                let columnas = [];
                                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                    columnas = [1, 4];
                                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                    columnas = [2, 5];
                                } else if (signalConfig.martin_gala === "nogale") {
                                    columnas = [3, 6];
                                }

                                let infoColores = [];
                                for (let col of columnas) {
                                    const cell = filaTabla.cells[col];
                                    const bg = cell?.style.backgroundColor.toLowerCase();
                                    if (bg === "green" || bg === "red") {
                                        const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                        const operacion = (bg === "green") ? "CALL" : "PUT";
                                        infoColores.push({ condicion, operacion });
                                    }
                                }

                                if (infoColores.length > 0) {
                                    const operaciones = infoColores.map(i => i.operacion);
                                    const operacionesUnicas = [...new Set(operaciones)];

                                    if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                        const operacion = operacionesUnicas[0];
                                        const condicion = infoColores[0].condicion;

                                        guardarAlertaEnSupabase(`${patron} con 2 p√©rdidas seguidas`, hora_final, "Alc/Baj", operacion, cantGale);
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup(`${patron} con 2 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram(`${patron} con 2 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                        }

                                    } else {
                                        for (let info of infoColores) {
                                            guardarAlertaEnSupabase(`${patron} con 2 p√©rdidas seguidas`, hora_final, info.condicion, info.operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con 2 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con 2 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                            }
                                        }
                                    }

                                    dosPerdidasSeguidas[patron] = false; // Reseteamos
                                }
                            }
                        }
                    }
                }

                if (signalConfig.perdidas_3) { // Notificaci√≥n para dos p√©rdidas consecutivas
                    detectarTresPerdidasSeguidas();
                    for (let patron in tresPerdidasSeguidas) {
                        if (tresPerdidasSeguidas[patron]) {
                            const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                fila => fila.cells[0]?.textContent.trim() === patron.trim()
                            );
                            if (filaTabla) {
                                let columnas = [];
                                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                    columnas = [1, 4];
                                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                    columnas = [2, 5];
                                } else if (signalConfig.martin_gala === "nogale") {
                                    columnas = [3, 6];
                                }

                                let infoColores = [];
                                for (let col of columnas) {
                                    const cell = filaTabla.cells[col];
                                    const bg = cell?.style.backgroundColor.toLowerCase();
                                    if (bg === "green" || bg === "red") {
                                        const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                        const operacion = (bg === "green") ? "CALL" : "PUT";
                                        infoColores.push({ condicion, operacion });
                                    }
                                }

                                if (infoColores.length > 0) {
                                    const operaciones = infoColores.map(i => i.operacion);
                                    const operacionesUnicas = [...new Set(operaciones)];

                                    if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                        const operacion = operacionesUnicas[0];
                                        const condicion = infoColores[0].condicion;

                                        guardarAlertaEnSupabase(`${patron} con 3 p√©rdidas seguidas`, hora_final, "Alc/Baj", operacion, cantGale);
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup(`${patron} con 3 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram(`${patron} con 3 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                        }

                                    } else {
                                        for (let info of infoColores) {
                                            guardarAlertaEnSupabase(`${patron} con 3 p√©rdidas seguidas`, hora_final, info.condicion, info.operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con 3 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con 3 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                            }
                                        }
                                    }

                                    tresPerdidasSeguidas[patron] = false; // Reseteamos
                                }
                            }
                        }
                    }
                }

                if (signalConfig.cuadrante_doji) {
                    detectarCaudranteConDoji();
                    for (let patron in cuadranteConDoji) {
                        if (cuadranteConDoji[patron]) {
                            const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                fila => fila.cells[0]?.textContent.trim() === patron.trim()
                            );
                            if (filaTabla) {
                                let columnas = [];
                                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                    columnas = [1, 4];
                                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                    columnas = [2, 5];
                                } else if (signalConfig.martin_gala === "nogale") {
                                    columnas = [3, 6];
                                }

                                let infoColores = [];
                                for (let col of columnas) {
                                    const cell = filaTabla.cells[col];
                                    const bg = cell?.style.backgroundColor.toLowerCase();
                                    if (bg === "green" || bg === "red") {
                                        const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                        const operacion = (bg === "green") ? "CALL" : "PUT";
                                        infoColores.push({ condicion, operacion });
                                    }
                                }

                                if (infoColores.length > 0) {
                                    const operaciones = infoColores.map(i => i.operacion);
                                    const operacionesUnicas = [...new Set(operaciones)];

                                    if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                        const operacion = operacionesUnicas[0];
                                        const condicion = infoColores[0].condicion;

                                        guardarAlertaEnSupabase(`${patron} con un cuadrante con Doji`, hora_final, "Alc/Baj", operacion, cantGale);
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup(`${patron} con con un cuadrante con Doji`, "Alc/Baj", operacion, gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram(`${patron} con con un cuadrante con Doji`, "Alc/Baj", operacion, gale);
                                        }

                                    } else {
                                        for (let info of infoColores) {
                                            guardarAlertaEnSupabase(`${patron} con con un cuadrante con Doji`, hora_final, info.condicion, info.operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con con un cuadrante con Doji`, info.condicion, info.operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con con un cuadrante con Doji`, info.condicion, info.operacion, gale);
                                            }
                                        }
                                    }
                                    cuadranteConDoji[patron] = false; // Reseteamos
                                }
                            }
                        }
                    }

                }





            }

        }

        async function guardarAlertaEnSupabase(signal, vela, condicion, operacion, numeroDeGale) {
            const alerta = {
                user_id: userId,
                se√±al: signal,
                par: analisisPar,
                vela_condicional: vela || null,
                condicion: condicion,
                operacion: operacion,
                loss: estadisticasPorcentual.rojo,
                martingala: numeroDeGale,
                resultado: null
            };
            const { data, error } = await clientesupabase
                .from("registro_alertas")
                .insert([alerta]);

            if (error) {
                console.error("Error guardando alerta en Supabase:", error.message);
            }
        }

        async function cargarSignalConfiguracion() {
            userId = "<%= user.id %>";
            try {
                const { data: config, error } = await clientesupabase
                    .from('configuracion_senal_usuario')
                    .select('*')
                    .eq('user_id', userId)
                    .maybeSingle();
                if (error) throw error;

                if (config) {
                    signalConfig = config
                }
            } catch (error) {
                console.error("Error al cargar configuraci√≥n:", error.message);
            }
        }

        function mostrarPopup(signal, condicion, operacion, mg) {
            const ahora = new Date();
            const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                ahora.getMinutes().toString().padStart(2, '0');
            const texto = `
                ${analisisPar} (%Loss ${estadisticasPorcentual.rojo})<br>
                ${signal}<br>
                Condici√≥n: Vela ${hora_final} ${condicion}<br>
                Operaci√≥n: ${operacion}<br>
                ${mg}
                `;
            const container = document.getElementById("popup-container");

            const popup = document.createElement("div");
            popup.className = "popup-alert";
            popup.innerHTML = `
                <div class="popup-content">
                    <button class="cerrar-popup" onclick="this.parentElement.parentElement.remove()">‚úñ</button>
                    <div class="popup-texto">${texto}</div>
                </div>
            `;
            container.appendChild(popup);
        }

        async function envioTelegram(signal, condicion, operacion, mg) {
            // Obtener la hora actual formateada
            const ahora = new Date();
            const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                ahora.getMinutes().toString().padStart(2, '0');

            // Construir el mensaje
            const texto = `${analisisPar} (%Loss ${estadisticasPorcentual.rojo})\n` +
                `${signal}\n` +
                `Condici√≥n: Vela ${hora_final} ${condicion}\n` +
                `Operaci√≥n: ${operacion}\n` +
                `${mg}\n` +
                `Resultado:`;

            const token = '7971141664:AAHBoQ6QoBUsv0GCkMZ3WgNTntYfCpgjxQE';

            try {

                // Obtener el chat_id del usuario desde Supabase
                const { data: telegramData, error: telegramError } = await clientesupabase
                    .from('telegram_chat_ids')
                    .select('chat_id')
                    .eq('user_id', userId)
                    .single();

                if (telegramError || !telegramData || !telegramData.chat_id) {
                    console.error('Error al obtener chat_id de Telegram:', telegramError?.message || 'No se encontr√≥ chat_id');
                    return false;
                }

                const chatId = telegramData.chat_id;

                // Enviar mensaje al chat_id espec√≠fico del usuario
                const url = `https://api.telegram.org/bot${token}/sendMessage`;
                const params = new URLSearchParams();
                params.append('chat_id', chatId);
                params.append('text', texto);
                params.append('parse_mode', 'HTML');

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Detalles del error:', errorData);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return true;
            } catch (error) {
                console.error('Error completo al enviar a Telegram:', {
                    error: error.message,
                    condicion,
                    operacion
                });
                return false;
            }
        }

        function calcularCantidadDeVelas() {
            const ahora = new Date();
            const ahoraTimestamp = ahora.getTime();// Hora actual
            const haceDosHoras = new Date(ahora);// Restar 2 horas
            haceDosHoras.setHours(haceDosHoras.getHours() - 2);
            const minutos = haceDosHoras.getMinutes();// Redondear los minutos hacia atr√°s al m√∫ltiplo de 10
            const minutosRedondeados = Math.floor(minutos / 10) * 10;
            haceDosHoras.setMinutes(minutosRedondeados, 0, 0); // tambi√©n pone segundos y ms en 0

            const inicioTimestamp = haceDosHoras.getTime();
            // ‚úÖ Mostrar hora legible


            const diferenciaMinutos = Math.floor((ahoraTimestamp - inicioTimestamp) / 60000);// Calcular diferencia en minutos
            return diferenciaMinutos;
        }

        function contarCeldasColoreadas() {
            const tabla = document.getElementById('tablaPatrones');
            const resultados = {
                verde: { verde: 0, rojo: 0 }, // Para las columnas de vela verde (1-3)
                rojo: { verde: 0, rojo: 0 }   // Para las columnas de vela roja (4-6)
            };

            // Recorrer todas las filas excepto los encabezados
            for (let i = 2; i < tabla.rows.length; i++) {
                const fila = tabla.rows[i];

                // Contar para columnas de vela verde (columnas 1-3)
                for (let j = 1; j <= 3; j++) {
                    const celda = fila.cells[j];
                    const bgColor = celda.style.backgroundColor.toLowerCase();

                    if (bgColor === 'green') {
                        resultados.verde.verde++;
                    } else if (bgColor === 'red') {
                        resultados.verde.rojo++;
                    }
                }

                // Contar para columnas de vela roja (columnas 4-6)
                for (let j = 4; j <= 6; j++) {
                    const celda = fila.cells[j];
                    const bgColor = celda.style.backgroundColor.toLowerCase();

                    if (bgColor === 'green') {
                        resultados.rojo.verde++;
                    } else if (bgColor === 'red') {
                        resultados.rojo.rojo++;
                    }
                }
            }
            return resultados;
        }

        function cerrarPopup() {
            document.getElementById("popup-se√±al").style.display = "none";
        }

        async function calcularPorcentaje() {
            const cuadros = document.querySelectorAll('.cuadro');
            estadisticasTotales = {
                rojo: 0,
                gris: 0,
                verde: 0,
                verde_G1: 0,
                verde_G2: 0
            };

            cuadros.forEach(cuadro => {
                const bg = cuadro.style.backgroundColor.toLowerCase();
                const txt = cuadro.textContent.trim().toUpperCase();

                if (bg === 'red' && txt === '') {
                    estadisticasTotales.rojo++;
                } else if (bg === 'gray' && txt === '') {
                    estadisticasTotales.gris++;
                } else if (bg === 'green' && txt === '') {
                    estadisticasTotales.verde++;
                } else if (bg === 'green' && txt === 'G1') {
                    estadisticasTotales.verde_G1++;
                } else if (bg === 'green' && txt === 'G2') {
                    estadisticasTotales.verde_G2++;
                }
            });

            const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);

            estadisticasPorcentual = {};
            for (let tipo in estadisticasTotales) {
                const cantidad = estadisticasTotales[tipo];
                const porcentaje = total > 0 ? ((cantidad / total) * 100).toFixed(2) : 0;
                estadisticasPorcentual[tipo] = porcentaje;
            }

            const divEstadisticas = document.getElementById("estadisticas-globales");
            if (divEstadisticas) {
                const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);
                const texto = `
                    <strong>Efectividad General de todos los patrones:</strong><br>
                    Cantidad de Win Directos: ${estadisticasTotales.verde} (${estadisticasPorcentual.verde}%)<br>
                    Cantidad en Gale 1: ${estadisticasTotales.verde_G1} (${estadisticasPorcentual.verde_G1}%)<br>
                    Cantidad en Gale 2: ${estadisticasTotales.verde_G2} (${estadisticasPorcentual.verde_G2}%)<br>
                    Cantidad de Pass: ${estadisticasTotales.gris} (${estadisticasPorcentual.gris}%)<br>
                    Cantidad de P√©rdidas: ${estadisticasTotales.rojo} (${estadisticasPorcentual.rojo}%)<br>
                `;
                divEstadisticas.innerHTML = texto;
            }



            return { estadisticasTotales, estadisticasPorcentual };
        }

        async function calcularPorcentajeNoPerdidasPorPatron() {
            const patrones = document.querySelectorAll('.patron');

            patrones.forEach(patron => {
                const h3 = patron.querySelector('h3');
                const nombreOriginal = h3.innerText.split(' (')[0]; // Quita porcentaje anterior
                const cuadros = patron.querySelectorAll('.cuadro');
                let perdidas = 0;
                let empate = 0;
                cuadros.forEach(cuadro => {
                    if (cuadro.style.backgroundColor.toLowerCase() === 'red') {
                        perdidas++;
                    }
                    if (cuadro.style.backgroundColor.toLowerCase() === 'gray') {
                        empate++;
                    }
                });
                const total = 24 - empate;
                const noPerdidas = total - perdidas;
                const porcentaje = ((noPerdidas / total) * 100).toFixed(0);
                h3.innerText = `${nombreOriginal} (${porcentaje}%)`;
                h3.style.color = porcentaje === "100" ? "green" : "";
                // Verificar cambio de estado
                const estabaEn100 = estadoAnteriorPatrones[nombreOriginal] === true;
                const estaEn100 = porcentaje === "100";
                // Guardar nuevo estado
                estadoAnteriorPatrones[nombreOriginal] = estaEn100;
                if (!estabaEn100 && estaEn100) {
                    alcanza100[nombreOriginal] = true;
                } else if (estabaEn100 && !estaEn100) {
                    pierde100[nombreOriginal] = true;
                }
            });

        }


        function detectarDosPerdidasSeguidas() {
            const patrones = document.querySelectorAll('.patron');
            patrones.forEach(patron => {
                const h3 = patron.querySelector('h3');
                const nombre = h3.innerText.split(' (')[0].trim();
                const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                const total = cuadros.length;

                // Si hay al menos 3 cuadros (por seguridad)
                if (total >= 24) {
                    const antepenultimo = cuadros[total - 3];
                    const penultimo = cuadros[total - 2];
                    const ultimo = cuadros[total - 1];

                    const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                    const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
                    const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();

                    // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                    if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo !== 'red') {
                        dosPerdidasSeguidas[nombre] = true;
                    } else {
                        dosPerdidasSeguidas[nombre] = false;
                    }
                } else {
                    dosPerdidasSeguidas[nombre] = false;
                }
            });
        }

        function detectarTresPerdidasSeguidas() {
            const patrones = document.querySelectorAll('.patron');
            patrones.forEach(patron => {
                const h3 = patron.querySelector('h3');
                const nombre = h3.innerText.split(' (')[0].trim();
                const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                const total = cuadros.length;
                // Si hay al menos 3 cuadros (por seguridad)
                if (total >= 24) {
                    const anteantepenultimo = cuadros[total - 4];
                    const antepenultimo = cuadros[total - 3];
                    const penultimo = cuadros[total - 2];
                    const ultimo = cuadros[total - 1];

                    const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                    const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
                    const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();
                    const colorAnteAntepenultimo = anteantepenultimo.style.backgroundColor.toLowerCase();

                    // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                    if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo === 'red' && colorAnteAntepenultimo !== 'red') {
                        tresPerdidasSeguidas[nombre] = true;
                    } else {
                        tresPerdidasSeguidas[nombre] = false;
                    }
                } else {
                    tresPerdidasSeguidas[nombre] = false;
                }
            });
        }

        function detectarCaudranteConDoji() {
            const patrones = document.querySelectorAll('.patron');
            patrones.forEach(patron => {
                const h3 = patron.querySelector('h3');
                const nombre = h3.innerText.split(' (')[0].trim();
                const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                const total = cuadros.length;
                // Si hay al menos 3 cuadros (por seguridad)
                if (total >= 24) {
                    const penultimo = cuadros[total - 2];
                    const ultimo = cuadros[total - 1];
                    const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                    const colorUltimo = ultimo.style.backgroundColor.toLowerCase();

                    // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                    if (colorPenultimo !== 'gray' && colorUltimo === 'gray') {
                        cuadranteConDoji[nombre] = true;
                    } else {
                        cuadranteConDoji[nombre] = false;
                    }
                } else {
                    cuadranteConDoji[nombre] = false;
                }
            });
        }

    </script>


    <script>

        function digito0(vela) {
            ultimaVela = coloresDigitos[0];
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 2).style.backgroundColor = '';
                getCelda(patron, 5).style.backgroundColor = '';
            });
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[0]) {
                    // Gana MHI Minor√≠a, pierde MHI Mayor√≠a
                    if (minoritario === 'green') {
                        getCelda('MHI Mayor√≠a', 3).style.backgroundColor = 'red';
                    } else if (minoritario === 'red') {
                        getCelda('MHI Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    // Gana MHI Mayor√≠a, pierde MHI Minor√≠a
                    if (minoritario === 'green') {
                        getCelda('MHI Minor√≠a', 6).style.backgroundColor = 'green';
                    } else if (minoritario === 'red') {
                        getCelda('MHI Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis Millon Minoria y Millon Minoria
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                if (minoritario === coloresDigitos[0]) {   //Se gana mill minoria y se pierde mill mayoria
                    if (minoritario === 'green') {
                        getCelda('Mill√≥n Mayor√≠a', 3).style.backgroundColor = 'red';
                    }
                    if (minoritario === 'red') {
                        getCelda('Mill√≥n Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('Mill√≥n Minor√≠a', 6).style.backgroundColor = 'green';
                    }
                    if (minoritario === 'red') {
                        getCelda('Mill√≥n Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === 'green') {
                    getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = 'green';

                }
            }
            //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === 'red') {
                    getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'red';

                }
            }
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 3).style.backgroundColor = '';
            getCelda('Torres Gemelas', 6).style.backgroundColor = '';
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 3).style.backgroundColor = '';
            getCelda('Tres Vecinos', 6).style.backgroundColor = '';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 1).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 4).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] === 'green') {
                    getCelda('Patr√≥n 23', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Patr√≥n 23', 2).style.backgroundColor = 'red';
                }
            }
            //Analasis para MEJOR DE TRES
            if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const minoritario = colorMenosRepetido([6, 7, 8]);
                if (minoritario === 'green') {
                    getCelda('Mejor de 3', 1).style.backgroundColor = 'red';
                    getCelda('Mejor de 3', 4).style.backgroundColor = 'red';
                } else {
                    getCelda('Mejor de 3', 1).style.backgroundColor = 'green';
                    getCelda('Mejor de 3', 4).style.backgroundColor = 'green';
                }
            }
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 3).style.backgroundColor = '';
            getCelda('Patron 3x1', 6).style.backgroundColor = '';
            // Analisis Patron Impar
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[0]) {
                    if (coloresDigitos[7] === 'green') {
                        getCelda('Patr√≥n Impar', 2).style.backgroundColor = 'green';
                        getCelda('Patr√≥n Impar', 5).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n Impar', 2).style.backgroundColor = 'red';
                        getCelda('Patr√≥n Impar', 5).style.backgroundColor = 'red';
                    }
                }
            }

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                historicoMHI.push("E");
                if (historicoMHI.length > 24) { historicoMHI.shift(); }
                actualizarHistorico("MHI_Minor√≠a", historicoMHI);

                historicoMHIMAY.push("E");
                if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
            } else {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[0]) {
                    historicoMHI.push("D");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario === coloresDigitos[0]) {
                    historicoMHIMAY.push("D");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }

            //MILLON mayoria y minoria
            if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {

                historicoMILLONMIN.push("E");
                if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);

                historicoMILLONMAY.push("E");
                if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
            } else {
                const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                if (minoritario === coloresDigitos[0]) {
                    historicoMILLONMIN.push("D");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);

                if (mayoritario === coloresDigitos[0]) {
                    historicoMILLONMAY.push("D");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] === coloresDigitos[0]) {
                    historicoTORRESGEMELAS.push("G1");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            //Tres Mosqueteros
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] === coloresDigitos[0]) {
                    historicoMOSQUETEROS.push("G2");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                } else if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] !== coloresDigitos[0]) {
                    historicoMOSQUETEROS.push("L");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron Impar
            if (coloresDigitos[7] === 'doji') {
                historicoPATRONIMPAR.push("E");
                if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
            } else {
                if (coloresDigitos[7] === coloresDigitos[0]) {
                    historicoPATRONIMPAR.push("D");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }



            //Tres Vecinos
            if (coloresDigitos[8] !== 'doji') {
                if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] === coloresDigitos[0]) {
                    historicoTRESVECINOS.push("G1");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 6, 7]);
                if (minoritario !== coloresDigitos[9] && minoritario === coloresDigitos[0]) {
                    historicoPATRON3X1.push("G1");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }
        }

        function digito1(vela) {
            ultimaVela = coloresDigitos[1];
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 3).style.backgroundColor = '';
                getCelda(patron, 6).style.backgroundColor = '';
            });
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[1]) {
                    if (minoritario === 'green') {
                        getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = 'red';
                    }
                    else {
                        getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = 'green';
                    }
                    else {
                        getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }//Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
            getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === 'green') {
                    getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = 'green';
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green';
            getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 2).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 5).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[1]) {
                    if (coloresDigitos[0] === 'green') {
                        getCelda('Patr√≥n 23', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n 23', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 1).style.backgroundColor = '';
            getCelda('Mejor de 3', 4).style.backgroundColor = '';
            if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const minoritario = colorMenosRepetido([6, 7, 8]);
                if (minoritario === "green") {
                    getCelda('Mejor de 3', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('Mejor de 3', 5).style.backgroundColor = 'green';
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 2).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 5).style.backgroundColor = '';

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                    historicoMHI.push("G1");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
                    historicoMHIMAY.push("G1");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }
            //MHI2 mayoria y minoria2
            if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                historicoMHI2.push("E");
                if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                historicoMHI2MAY.push("E");
                if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
            } else {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[1]) {
                    historicoMHI2.push("D");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario === coloresDigitos[1]) {
                    historicoMHI2MAY.push("D");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI mayoria y minoria
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                    historicoMILLONMIN.push("G1");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);
                if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
                    historicoMILLONMAY.push("G1");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] === coloresDigitos[1]) {
                    historicoTORRESGEMELAS.push("G2");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                } else if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] !== coloresDigitos[1]) {
                    historicoTORRESGEMELAS.push("L");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            //Tres Vecinos
            if (coloresDigitos[8] !== 'doji') {
                if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] === coloresDigitos[1]) {
                    historicoTRESVECINOS.push("G2");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                } else if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] !== coloresDigitos[1]) {
                    historicoTRESVECINOS.push("L");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 6, 7]);
                if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                    historicoPATRON3X1.push("G2");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                } else if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {
                    historicoPATRON3X1.push("L");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }
            //Patron 23
            if (coloresDigitos[0] === 'doji') {
                historicoPADRON23.push("E");
                if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                actualizarHistorico("Patr√≥n_23", historicoPADRON23);
            } else {
                if (coloresDigitos[0] === coloresDigitos[1]) {
                    historicoPADRON23.push("D");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }
        }

        function digito2(vela) {
            ultimaVela = coloresDigitos[2];
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[2]) {
                    if (minoritario === 'green') {
                        getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = 'red';
                    } else {
                        getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analasis para Torres Gemelas
            if (coloresDigitos[0] !== 'doji') {
                getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[0];
                getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[0];
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] === 'green') {
                    getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 1).style.backgroundColor = 'green';
            getCelda('Tres Vecinos', 4).style.backgroundColor = 'red';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 3).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 6).style.backgroundColor = '';
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 2).style.backgroundColor = '';
            getCelda('Mejor de 3', 5).style.backgroundColor = '';
            if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 7, 8]);
                if (minoritario === coloresDigitos[2]) {
                    if (minoritario === "green") {
                        getCelda('Mejor de 3', 3).style.backgroundColor = 'red';
                    } else {
                        getCelda('Mejor de 3', 6).style.backgroundColor = 'green';
                    }
                }
            }
            //Analisis Patron 3x1
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([0, 1, 2]);
                getCelda('Patron 3x1', 1).style.backgroundColor = minoritario;
                getCelda('Patron 3x1', 4).style.backgroundColor = minoritario;

            }
            // Analisis Patron Impar
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2]) {
                    if (coloresDigitos[7] === 'green') {
                        getCelda('Patr√≥n Impar', 3).style.backgroundColor = 'green';
                        getCelda('Patr√≥n Impar', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n Impar', 3).style.backgroundColor = 'red';
                        getCelda('Patr√≥n Impar', 6).style.backgroundColor = 'red';
                    }
                }
            }

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                    historicoMHI.push("G2");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
                    historicoMHI.push("L");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                    historicoMHIMAY.push("G2");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
                    historicoMHIMAY.push("L");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }
            //MHI mayoria2 y minoria2
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                    historicoMHI2.push("G1");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                    historicoMHI2MAY.push("G1");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI3 mayoria y minoria3
            if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                historicoMHI3.push("E");
                if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                historicoMHI3MAY.push("E");
                if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
            } else {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === coloresDigitos[2]) {
                    historicoMHI3.push("D");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario === coloresDigitos[2]) {
                    historicoMHI3MAY.push("D");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                    historicoMILLONMIN.push("G2");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
                    historicoMILLONMIN.push("L");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);
                if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                    historicoMILLONMAY.push("G2");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
                    historicoMILLONMAY.push("L");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Mejor de 3
            if (coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji') {
                historicoMEJOR3.push("E");
                if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                actualizarHistorico("Mejor_de_3", historicoMEJOR3);
            } else {
                const mayoritario = colorMasRepetido([6, 7, 8]);
                if (mayoritario === coloresDigitos[2]) {
                    historicoMEJOR3.push("D");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            //Patron Impar
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] === coloresDigitos[2]) {
                    historicoPATRONIMPAR.push("G1");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }
            //Patron 23
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] === coloresDigitos[2]) {
                    historicoPADRON23.push("G1");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }
        }

        function digito3(vela) {
            ultimaVela = coloresDigitos[3];
            //MHI Minoria y MHI Mayoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                if (coloresDigitos[2] === coloresDigitos[3]) {
                    const opuesto = coloresDigitos[2] === 'red' ? 'green' : 'red';
                    getCelda('MHI Minor√≠a', 1).style.backgroundColor = opuesto;
                    getCelda('MHI Minor√≠a', 4).style.backgroundColor = opuesto;
                    getCelda('MHI Mayor√≠a', 1).style.backgroundColor = coloresDigitos[2];
                    getCelda('MHI Mayor√≠a', 4).style.backgroundColor = coloresDigitos[2];
                } else {
                    getCelda('MHI Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            //Millon Minoria y Millon Mayoria
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const minoritario = colorMenosRepetido([0, 1, 2, 3]);
                if (minoritario === 'empate') {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red';
                }
                else if (minoritario === 'red') {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'green';
                }
                else {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = '';
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 1).style.backgroundColor = '';
            getCelda('Torres Gemelas', 4).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] === 'green') {
                    getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[0];
                } else {
                    getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[0];
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[3]) {
                    if (coloresDigitos[2] === 'green') {
                        getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 1).style.backgroundColor = '';
            getCelda('Tres Vecinos', 4).style.backgroundColor = '';
            if (coloresDigitos[3] !== 'doji') {
                if (coloresDigitos[3] === 'green') {
                    getCelda('Tres Vecinos', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Tres Vecinos', 2).style.backgroundColor = 'red';
                }
            }
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 3).style.backgroundColor = '';
            getCelda('Mejor de 3', 6).style.backgroundColor = '';
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 1).style.backgroundColor = '';
            getCelda('Patron 3x1', 4).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([0, 1, 2]);
                if (minoritario === 'green') {
                    getCelda('Patron 3x1', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Patron 3x1', 2).style.backgroundColor = 'red';
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 3).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 6).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji') {
                getCelda('Patr√≥n Impar', 1).style.backgroundColor = coloresDigitos[2];
                getCelda('Patr√≥n Impar', 4).style.backgroundColor = coloresDigitos[2];
            }

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria2 y minoria2
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
                    historicoMHI2.push("G2");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                } else if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3]) {
                    historicoMHI2.push("L");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                    historicoMHI2MAY.push("G2");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                } else if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
                    historicoMHI2MAY.push("L");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI mayoria3 y minoria3
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
                    historicoMHI3.push("G1");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                    historicoMHI3MAY.push("G1");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const mayoritario = colorMasRepetido([6, 7, 8]);
                if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                    historicoMEJOR3.push("G1");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            //Tres Mosqueteros
            if (coloresDigitos[2] === 'doji') {
                historicoMOSQUETEROS.push("E");
                if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
            } else {
                if (coloresDigitos[2] === coloresDigitos[3]) {
                    historicoMOSQUETEROS.push("D");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron 23
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] === coloresDigitos[3]) {
                    historicoPADRON23.push("G2");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                } else if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] !== coloresDigitos[3]) {
                    historicoPADRON23.push("L");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }
        }

        function digito4(vela) {
            ultimaVela = coloresDigitos[4];
            //Analisis Correspondiente a MHMI Minoria MHI Mayoria
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 1).style.backgroundColor = '';
                getCelda(patron, 4).style.backgroundColor = '';
            });
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === 'red') {
                    getCelda('MHI Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI Mayor√≠a', 5).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis Correspondiente a Mill√≥n Minoria Mill√≥n Mayoria
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                if (minoritario === 'red') {
                    getCelda('Mill√≥n Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Mill√≥n Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 2).style.backgroundColor = 'red';
                }
            }

            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === 'red') {
                    getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'red';

                }
            }
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 2).style.backgroundColor = '';
            getCelda('Torres Gemelas', 5).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[4]) {
                    if (coloresDigitos[0] === 'green') {
                        getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0];
                    } else {
                        getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0];
                    }
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 2).style.backgroundColor = '';
            getCelda('Tres Vecinos', 5).style.backgroundColor = '';
            if (coloresDigitos[3] !== 'doji') {
                if (coloresDigitos[3] !== coloresDigitos[4]) {
                    if (coloresDigitos[3] === 'green') {
                        getCelda('Tres Vecinos', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Tres Vecinos', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 1).style.backgroundColor = 'green';
            getCelda('Patr√≥n 23', 4).style.backgroundColor = 'red';
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 2).style.backgroundColor = '';
            getCelda('Patron 3x1', 5).style.backgroundColor = '';
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([0, 1, 2]);
                if (minoritario !== coloresDigitos[4]) {
                    if (minoritario === 'green') {
                        getCelda('Patron 3x1', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patron 3x1', 3).style.backgroundColor = 'red';
                    }
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 1).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 4).style.backgroundColor = '';

            //MHI mayoria3 y minoria3
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario === coloresDigitos[4]) {
                    historicoMHI3.push("G2");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                } else if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario !== coloresDigitos[4]) {
                    historicoMHI3.push("L");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([7, 8, 9]);
                if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
                    historicoMHI3MAY.push("G2");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {
                    historicoMHI3MAY.push("L");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[0] === 'doji') {
                historicoTORRESGEMELAS.push("E");
                if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
            } else {
                if (coloresDigitos[0] === coloresDigitos[4]) {
                    historicoTORRESGEMELAS.push("D");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const mayoritario = colorMasRepetido([6, 7, 8]);
                if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
                    historicoMEJOR3.push("G2");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {
                    historicoMEJOR3.push("L");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            //Tres mosqueteros
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] === coloresDigitos[4]) {
                    historicoMOSQUETEROS.push("G1");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron Impar
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] === coloresDigitos[4]) {
                    historicoPATRONIMPAR.push("G2");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                } else if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] !== coloresDigitos[4]) {
                    historicoPATRONIMPAR.push("L");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }
            //Tres Vecinos
            if (coloresDigitos[3] === 'doji') {
                historicoTRESVECINOS.push("E");
                if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
            } else {
                if (coloresDigitos[3] === coloresDigitos[4]) {
                    historicoTRESVECINOS.push("D");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji') {
                historicoPATRON3X1.push("E");
                if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                actualizarHistorico("Patron_3x1", historicoPATRON3X1);
            } else {
                const minoritario = colorMenosRepetido([0, 1, 2]);
                if (minoritario === coloresDigitos[4]) {
                    historicoPATRON3X1.push("D");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }
        }

        function digito5(vela) {
            ultimaVela = coloresDigitos[5];
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 2).style.backgroundColor = '';
                getCelda(patron, 5).style.backgroundColor = '';
            });
            //Analisis Correspondiente a NHI Minoria MHI Mayoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[5]) {
                    // Gana MHI Minor√≠a, pierde MHI Mayor√≠a
                    if (minoritario === 'green') {
                        getCelda('MHI Mayor√≠a', 3).style.backgroundColor = 'red';
                    } else if (minoritario === 'red') {
                        getCelda('MHI Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    // Gana MHI Mayor√≠a, pierde MHI Minor√≠a
                    if (minoritario === 'green') {
                        getCelda('MHI Minor√≠a', 6).style.backgroundColor = 'green';
                    } else if (minoritario === 'red') {
                        getCelda('MHI Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis Correspondiente a Mill√≥n Minoria Mill√≥n Mayoria
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                if (minoritario === coloresDigitos[5]) {   //Se gana mill minoria y se pierde mill mayoria
                    if (minoritario === 'green') {
                        getCelda('Mill√≥n Mayor√≠a', 3).style.backgroundColor = 'red';
                    }
                    if (minoritario === 'red') {
                        getCelda('Mill√≥n Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('Mill√≥n Minor√≠a', 6).style.backgroundColor = 'green';
                    }
                    if (minoritario === 'red') {
                        getCelda('Mill√≥n Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === 'green') {
                    getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = 'green';
                }
            }
            //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === 'red') {
                    getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 3).style.backgroundColor = '';
            getCelda('Torres Gemelas', 6).style.backgroundColor = '';
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 3).style.backgroundColor = '';
            getCelda('Tres Vecinos', 6).style.backgroundColor = '';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 1).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 4).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] === 'green') {
                    getCelda('Patr√≥n 23', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Patr√≥n 23', 2).style.backgroundColor = 'red';
                }
            }
            //Analasis para MEJOR DE TRES
            if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const minoritario = colorMenosRepetido([1, 2, 3]);
                if (minoritario === 'green') {
                    getCelda('Mejor de 3', 1).style.backgroundColor = 'red';
                    getCelda('Mejor de 3', 4).style.backgroundColor = 'red';
                } else {
                    getCelda('Mejor de 3', 1).style.backgroundColor = 'green';
                    getCelda('Mejor de 3', 4).style.backgroundColor = 'green';
                }
            }
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 3).style.backgroundColor = '';
            getCelda('Patron 3x1', 6).style.backgroundColor = '';
            // Analisis Patron Impar
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[5]) {
                    if (coloresDigitos[2] === 'green') {
                        getCelda('Patr√≥n Impar', 2).style.backgroundColor = 'green';
                        getCelda('Patr√≥n Impar', 5).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n Impar', 2).style.backgroundColor = 'red';
                        getCelda('Patr√≥n Impar', 5).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                historicoMHI.push("E");
                if (historicoMHI.length > 24) { historicoMHI.shift(); }
                actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                historicoMHIMAY.push("E");
                if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
            } else {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[5]) {
                    historicoMHI.push("D");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario === coloresDigitos[5]) {
                    historicoMHIMAY.push("D");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }
            //MHI mayoria y minoria
            if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                historicoMILLONMIN.push("E");
                if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                historicoMILLONMAY.push("E");
                if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
            } else {
                const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                if (minoritario === coloresDigitos[5]) {
                    historicoMILLONMIN.push("D");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
                if (mayoritario === coloresDigitos[5]) {
                    historicoMILLONMAY.push("D");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] === coloresDigitos[5]) {
                    historicoTORRESGEMELAS.push("G1");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            //Tres Mosqueteros
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] === coloresDigitos[5]) {
                    historicoMOSQUETEROS.push("G2");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                } else if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] !== coloresDigitos[5]) {
                    historicoMOSQUETEROS.push("L");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron Impar
            if (coloresDigitos[2] === 'doji') {
                historicoPATRONIMPAR.push("E");
                if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
            } else {
                if (coloresDigitos[2] === coloresDigitos[5]) {
                    historicoPATRONIMPAR.push("D");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }
            //Tres Vecinos
            if (coloresDigitos[3] !== 'doji') {
                if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] === coloresDigitos[5]) {
                    historicoTRESVECINOS.push("G1");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
                const minoritario = colorMenosRepetido([0, 1, 2]);
                if (minoritario !== coloresDigitos[4] && minoritario === coloresDigitos[5]) {
                    historicoPATRON3X1.push("G1");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }



        }

        function digito6(vela) {
            ultimaVela = coloresDigitos[6];
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 3).style.backgroundColor = '';
                getCelda(patron, 6).style.backgroundColor = '';
            });
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[6]) {
                    if (minoritario === 'green') {
                        getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = 'red';
                    }
                    else {
                        getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = 'green';
                    }
                    else {
                        getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
            getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === 'green') {
                    getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = 'green';
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green';
            getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 2).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 5).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[6]) {
                    if (coloresDigitos[5] === 'green') {
                        getCelda('Patr√≥n 23', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n 23', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 1).style.backgroundColor = '';
            getCelda('Mejor de 3', 4).style.backgroundColor = '';
            if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const minoritario = colorMenosRepetido([1, 2, 3]);
                if (minoritario === "green") {
                    getCelda('Mejor de 3', 2).style.backgroundColor = 'red';
                } else {
                    getCelda('Mejor de 3', 5).style.backgroundColor = 'green';
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 2).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 5).style.backgroundColor = '';

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                    historicoMHI.push("G1");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
                    historicoMHIMAY.push("G1");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }
            //MHI mayoria2 y minoria2
            if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                historicoMHI2.push("E");
                if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                historicoMHI2MAY.push("E");
                if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
            } else {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[6]) {
                    historicoMHI2.push("D");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario === coloresDigitos[6]) {
                    historicoMHI2MAY.push("D");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI mayoria y minoria
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                    historicoMILLONMIN.push("G1");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
                if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
                    historicoMILLONMAY.push("G1");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[0] !== 'doji') {
                if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] === coloresDigitos[6]) {
                    historicoTORRESGEMELAS.push("G2");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                } else if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] !== coloresDigitos[6]) {
                    historicoTORRESGEMELAS.push("L");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            //Tres Vecinos
            if (coloresDigitos[3] !== 'doji') {
                if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] === coloresDigitos[6]) {
                    historicoTRESVECINOS.push("G2");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                } else if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] !== coloresDigitos[6]) {
                    historicoTRESVECINOS.push("L");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
                const minoritario = colorMenosRepetido([0, 1, 2]);
                if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                    historicoPATRON3X1.push("G2");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                } else if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {
                    historicoPATRON3X1.push("L");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }
            //Patron 23
            if (coloresDigitos[5] === 'doji') {
                historicoPADRON23.push("E");
                if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                actualizarHistorico("Patr√≥n_23", historicoPADRON23);
            } else {
                if (coloresDigitos[5] === coloresDigitos[6]) {
                    historicoPADRON23.push("D");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }

        }

        function digito7(vela) {
            ultimaVela = coloresDigitos[7];
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = '';
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[7]) {
                    if (minoritario === 'green') {
                        getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = 'red';
                    } else {
                        getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = 'green';
                    }
                } else {
                    if (minoritario === 'green') {
                        getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analasis para Torres Gemelas
            if (coloresDigitos[5] !== 'doji') {
                getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[5];
                getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[5];
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] === 'green') {
                    getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 1).style.backgroundColor = 'green';
            getCelda('Tres Vecinos', 4).style.backgroundColor = 'red';
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 3).style.backgroundColor = '';
            getCelda('Patr√≥n 23', 6).style.backgroundColor = '';
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 2).style.backgroundColor = '';
            getCelda('Mejor de 3', 5).style.backgroundColor = '';
            if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const minoritario = colorMenosRepetido([1, 2, 3]);
                if (minoritario === coloresDigitos[7]) {
                    if (minoritario === "green") {
                        getCelda('Mejor de 3', 3).style.backgroundColor = 'red';
                    } else {
                        getCelda('Mejor de 3', 6).style.backgroundColor = 'green';
                    }
                }
            }
            //Analasis para MEJOR DE TRES
            getCelda('Mejor de 3', 3).style.backgroundColor = '';
            getCelda('Mejor de 3', 6).style.backgroundColor = '';
            //Analisis Patron 3x1
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([5, 6, 7]);
                getCelda('Patron 3x1', 1).style.backgroundColor = minoritario;
                getCelda('Patron 3x1', 4).style.backgroundColor = minoritario;

            }
            // Analisis Patron Impar
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[2]) {
                    if (coloresDigitos[2] === 'green') {
                        getCelda('Patr√≥n Impar', 3).style.backgroundColor = 'green';
                        getCelda('Patr√≥n Impar', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patr√≥n Impar', 3).style.backgroundColor = 'red';
                        getCelda('Patr√≥n Impar', 6).style.backgroundColor = 'red';
                    }
                }
            }

            //Analisis de las que pueden ganar en este digito:
            //MHI mayoria y minoria
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                    historicoMHI.push("G2");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {
                    historicoMHI.push("L");
                    if (historicoMHI.length > 24) { historicoMHI.shift(); }
                    actualizarHistorico("MHI_Minor√≠a", historicoMHI);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                    historicoMHIMAY.push("G2");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
                    historicoMHIMAY.push("L");
                    if (historicoMHIMAY.length > 24) { historicoMHIMAY.shift(); }
                    actualizarHistorico("MHI_Mayor√≠a", historicoMHIMAY);
                }
            }
            //MHI mayoria2 y minoria2
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                    historicoMHI2.push("G1");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                    historicoMHI2MAY.push("G1");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI mayoria3 y minoria3
            if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                historicoMHI3.push("E");
                if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                historicoMHI3MAY.push("E");
                if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
            } else {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario === coloresDigitos[7]) {
                    historicoMHI3.push("D");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario === coloresDigitos[7]) {
                    historicoMHI3MAY.push("D");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            //MHI mayoria y minoria
            if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                    historicoMILLONMIN.push("G2");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {
                    historicoMILLONMIN.push("L");
                    if (historicoMILLONMIN.length > 24) { historicoMILLONMIN.shift(); }
                    actualizarHistorico("Mill√≥n_Minor√≠a", historicoMILLONMIN);
                }
                const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
                if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                    historicoMILLONMAY.push("G2");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
                    historicoMILLONMAY.push("L");
                    if (historicoMILLONMAY.length > 24) { historicoMILLONMAY.shift(); }
                    actualizarHistorico("Mill√≥n_Mayor√≠a", historicoMILLONMAY);
                }
            }
            //Mejor de 3
            if (coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji') {
                historicoMEJOR3.push("E");
                if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                actualizarHistorico("Mejor_de_3", historicoMEJOR3);
            } else {
                const mayoritario = colorMasRepetido([1, 2, 3]);
                if (mayoritario === coloresDigitos[7]) {
                    historicoMEJOR3.push("D");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            // Analisis Patron Impar
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] === coloresDigitos[7]) {
                    historicoPATRONIMPAR.push("G1");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }
            //Patron 23
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] === coloresDigitos[7]) {
                    historicoPADRON23.push("G1");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }

        }

        function digito8(vela) {
            ultimaVela = coloresDigitos[8];
            //MHI Minoria y MHI Mayoria
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                if (coloresDigitos[7] === coloresDigitos[8]) {
                    const opuesto = coloresDigitos[7] === 'red' ? 'green' : 'red';
                    getCelda('MHI Minor√≠a', 1).style.backgroundColor = opuesto;
                    getCelda('MHI Minor√≠a', 4).style.backgroundColor = opuesto;
                    getCelda('MHI Mayor√≠a', 1).style.backgroundColor = coloresDigitos[7];
                    getCelda('MHI Mayor√≠a', 4).style.backgroundColor = coloresDigitos[7];
                } else {
                    getCelda('MHI Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            //Millon Minoria y Millon Mayoria
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                const minoritario = colorMenosRepetido([5, 6, 7, 8]);
                if (minoritario === 'empate') {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red';
                }
                else if (minoritario === 'red') {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'green';
                }
                else {
                    getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = '';
            getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = '';
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 1).style.backgroundColor = '';
            getCelda('Torres Gemelas', 4).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] === 'green') {
                    getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[5];
                } else {
                    getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[5];
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[8]) {
                    if (coloresDigitos[7] === 'green') {
                        getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 1).style.backgroundColor = '';
            getCelda('Tres Vecinos', 4).style.backgroundColor = '';
            if (coloresDigitos[8] !== 'doji') {
                if (coloresDigitos[8] === 'green') {
                    getCelda('Tres Vecinos', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Tres Vecinos', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 1).style.backgroundColor = '';
            getCelda('Patron 3x1', 4).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([5, 6, 7]);
                if (minoritario === 'green') {
                    getCelda('Patron 3x1', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Patron 3x1', 2).style.backgroundColor = 'red';
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 3).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 6).style.backgroundColor = '';
            if (coloresDigitos[7] !== 'doji') {
                getCelda('Patr√≥n Impar', 1).style.backgroundColor = coloresDigitos[7];
                getCelda('Patr√≥n Impar', 4).style.backgroundColor = coloresDigitos[7];
            }
            //Analisis de las que pueden ganar en este digito:
            //MHI2 mayoria y minoria2
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
                    historicoMHI2.push("G2");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                } else if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8]) {
                    historicoMHI2.push("L");
                    if (historicoMHI2.length > 24) { historicoMHI2.shift(); }
                    actualizarHistorico("MHI_2_Minor√≠a", historicoMHI2);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                    historicoMHI2MAY.push("G2");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                } else if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
                    historicoMHI2MAY.push("L");
                    if (historicoMHI2MAY.length > 24) { historicoMHI2MAY.shift(); }
                    actualizarHistorico("MHI_2_Mayor√≠a", historicoMHI2MAY);
                }
            }
            //MHI mayoria3 y minoria3
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
                    historicoMHI3.push("G1");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                    historicoMHI3MAY.push("G1");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const mayoritario = colorMasRepetido([1, 2, 3]);
                if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                    historicoMEJOR3.push("G1");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            //Tres Mosqueteros
            if (coloresDigitos[7] === 'doji') {
                historicoMOSQUETEROS.push("E");
                if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
            } else {
                if (coloresDigitos[7] === coloresDigitos[8]) {
                    historicoMOSQUETEROS.push("D");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron 23
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] === coloresDigitos[8]) {
                    historicoPADRON23.push("G2");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                } else if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] !== coloresDigitos[8]) {
                    historicoPADRON23.push("L");
                    if (historicoPADRON23.length > 24) { historicoPADRON23.shift(); }
                    actualizarHistorico("Patr√≥n_23", historicoPADRON23);
                }
            }

        }

        function digito9(vela) {
            ultimaVela = coloresDigitos[9];
            //Analisis Correspondiente a MHMI Minoria MHI Mayoria
            ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                getCelda(patron, 1).style.backgroundColor = '';
                getCelda(patron, 4).style.backgroundColor = '';
            });
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === 'red') {
                    getCelda('MHI Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('MHI Mayor√≠a', 5).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('MHI Mayor√≠a', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis Correspondiente a MHMill√≥nMI Minoria
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                if (minoritario === 'red') {
                    getCelda('Mill√≥n Minor√≠a', 2).style.backgroundColor = 'red';
                    getCelda('Mill√≥n Mayor√≠a', 5).style.backgroundColor = 'green';
                } else {
                    getCelda('Mill√≥n Minor√≠a', 5).style.backgroundColor = 'green';
                    getCelda('Mill√≥n Mayor√≠a', 2).style.backgroundColor = 'red';
                }
            }
            //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
            if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                const minoritario = colorMenosRepetido([7, 8, 9]);
                if (minoritario === 'red') {
                    getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'green';
                } else if (minoritario === 'green') {
                    getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'green';
                    getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'green';
                    getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'red';
                    getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'red';
                }
            }
            //Analasis para Torres Gemelas
            getCelda('Torres Gemelas', 2).style.backgroundColor = '';
            getCelda('Torres Gemelas', 5).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji') {
                if (coloresDigitos[5] !== coloresDigitos[9]) {
                    if (coloresDigitos[5] === 'green') {
                        getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0];
                    } else {
                        getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0];
                    }
                }
            }
            //Analisis correspondiente a TRES MOSQUETEROS
            getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
            getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
            //Analisis correspondiente a TRES VECINOS
            getCelda('Tres Vecinos', 2).style.backgroundColor = '';
            getCelda('Tres Vecinos', 5).style.backgroundColor = '';
            if (coloresDigitos[8] !== 'doji') {
                if (coloresDigitos[8] !== coloresDigitos[9]) {
                    if (coloresDigitos[8] === 'green') {
                        getCelda('Tres Vecinos', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Tres Vecinos', 3).style.backgroundColor = 'red';
                    }
                }
            }
            //Analisis correspondiente a PATRON 23
            getCelda('Patr√≥n 23', 1).style.backgroundColor = 'green';
            getCelda('Patr√≥n 23', 4).style.backgroundColor = 'red';
            //Analisis Patron 3x1
            getCelda('Patron 3x1', 2).style.backgroundColor = '';
            getCelda('Patron 3x1', 5).style.backgroundColor = '';
            if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                const minoritario = colorMenosRepetido([5, 6, 7]);
                if (minoritario !== coloresDigitos[4]) {
                    if (minoritario === 'green') {
                        getCelda('Patron 3x1', 6).style.backgroundColor = 'green';
                    } else {
                        getCelda('Patron 3x1', 3).style.backgroundColor = 'red';
                    }
                }
            }
            // Analisis Patron Impar
            getCelda('Patr√≥n Impar', 1).style.backgroundColor = '';
            getCelda('Patr√≥n Impar', 4).style.backgroundColor = '';

            //MHI2 mayoria y minoria2
            if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                const minoritario = colorMenosRepetido([2, 3, 4]);
                if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario === coloresDigitos[9]) {
                    historicoMHI3.push("G2");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                } else if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario !== coloresDigitos[9]) {
                    historicoMHI3.push("L");
                    if (historicoMHI3.length > 24) { historicoMHI3.shift(); }
                    actualizarHistorico("MHI_3_Minor√≠a", historicoMHI3);
                }
                const mayoritario = colorMasRepetido([2, 3, 4]);
                if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
                    historicoMHI3MAY.push("G2");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {
                    historicoMHI3MAY.push("L");
                    if (historicoMHI3MAY.length > 24) { historicoMHI3MAY.shift(); }
                    actualizarHistorico("MHI_3_Mayor√≠a", historicoMHI3MAY);
                }
            }
            //Torres Gemelas
            if (coloresDigitos[5] === 'doji') {
                historicoTORRESGEMELAS.push("E");
                if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
            } else {
                if (coloresDigitos[5] === coloresDigitos[9]) {
                    historicoTORRESGEMELAS.push("D");
                    if (historicoTORRESGEMELAS.length > 24) { historicoTORRESGEMELAS.shift(); }
                    actualizarHistorico("Torres_Gemelas", historicoTORRESGEMELAS);
                }
            }
            //Mejor de 3
            if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                const mayoritario = colorMasRepetido([1, 2, 3]);
                if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
                    historicoMEJOR3.push("G2");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {
                    historicoMEJOR3.push("L");
                    if (historicoMEJOR3.length > 24) { historicoMEJOR3.shift(); }
                    actualizarHistorico("Mejor_de_3", historicoMEJOR3);
                }
            }
            //Tres mosqueteros
            if (coloresDigitos[7] !== 'doji') {
                if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] === coloresDigitos[9]) {
                    historicoMOSQUETEROS.push("G1");
                    if (historicoMOSQUETEROS.length > 24) { historicoMOSQUETEROS.shift(); }
                    actualizarHistorico("Tres_Mosqueteros", historicoMOSQUETEROS);
                }
            }
            //Patron Impar
            if (coloresDigitos[2] !== 'doji') {
                if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] === coloresDigitos[9]) {
                    historicoPATRONIMPAR.push("G2");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                } else if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] !== coloresDigitos[9]) {
                    historicoPATRONIMPAR.push("L");
                    if (historicoPATRONIMPAR.length > 24) { historicoPATRONIMPAR.shift(); }
                    actualizarHistorico("Patr√≥n_Impar", historicoPATRONIMPAR);
                }
            }
            //Tres Vecinos
            if (coloresDigitos[8] === 'doji') {
                historicoTRESVECINOS.push("E");
                if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
            } else {
                if (coloresDigitos[8] === coloresDigitos[9]) {
                    historicoTRESVECINOS.push("D");
                    if (historicoTRESVECINOS.length > 24) { historicoTRESVECINOS.shift(); }
                    actualizarHistorico("Tres_Vecinos", historicoTRESVECINOS);
                }
            }
            //Patron 3x1
            if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji') {
                historicoPATRON3X1.push("E");
                if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                actualizarHistorico("Patron_3x1", historicoPATRON3X1);
            } else {
                const minoritario = colorMenosRepetido([5, 6, 7]);
                if (minoritario === coloresDigitos[9]) {
                    historicoPATRON3X1.push("D");
                    if (historicoPATRON3X1.length > 24) { historicoPATRON3X1.shift(); }
                    actualizarHistorico("Patron_3x1", historicoPATRON3X1);
                }
            }
        }


    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleSidebarBtn = document.getElementById('toggle-sidebar');
            const toggleRightBtn = document.getElementById('toggle-right-panel');
            const sidebar = document.querySelector('.sidebar');
            const rightPanel = document.querySelector('.right-panel');


            // Crear overlay
            const overlay = document.createElement('div');
            overlay.className = 'mobile-overlay';
            document.body.appendChild(overlay);

            // Crear bot√≥n de cerrar para sidebar
            const closeSidebarBtn = document.createElement('button');
            closeSidebarBtn.className = 'close-sidebar';
            closeSidebarBtn.innerHTML = '√ó';
            sidebar.appendChild(closeSidebarBtn);

            // Crear bot√≥n de cerrar para panel derecho
            const closeRightBtn = document.createElement('button');
            closeRightBtn.className = 'close-panel';
            closeRightBtn.innerHTML = '√ó';
            rightPanel.appendChild(closeRightBtn);

            // Funciones para sidebar
            function showSidebar() {
                sidebar.classList.add('show');
                overlay.classList.add('show');
                toggleSidebarBtn.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function hideSidebar() {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
                toggleSidebarBtn.classList.remove('active');
                document.body.style.overflow = '';
            }

            // Funciones para panel derecho
            function showRightPanel() {
                rightPanel.classList.add('show');
                overlay.classList.add('show');
                toggleRightBtn.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function hideRightPanel() {
                rightPanel.classList.remove('show');
                overlay.classList.remove('show');
                toggleRightBtn.classList.remove('active');
                document.body.style.overflow = '';
            }

            // Event listeners
            toggleSidebarBtn.addEventListener('click', function () {
                if (sidebar.classList.contains('show')) {
                    hideSidebar();
                } else {
                    hideRightPanel(); // Cerrar panel derecho si est√° abierto
                    showSidebar();
                }
            });

            toggleRightBtn.addEventListener('click', function () {
                if (rightPanel.classList.contains('show')) {
                    hideRightPanel();
                } else {
                    hideSidebar(); // Cerrar sidebar si est√° abierto
                    showRightPanel();
                }
            });

            // Cerrar con botones X
            closeSidebarBtn.addEventListener('click', hideSidebar);
            closeRightBtn.addEventListener('click', hideRightPanel);

            // Cerrar tocando overlay
            overlay.addEventListener('click', function () {
                hideSidebar();
                hideRightPanel();
            });

            // Cerrar con tecla Escape
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    hideSidebar();
                    hideRightPanel();
                }
            });
        });
    </script>




</body>

</html>





</body>

</html>